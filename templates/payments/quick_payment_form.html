{% extends "base.html" %}

{% block title %}Paiement rapide ‚Äî {{ invoice.invoice_number }}{% endblock %}
{% block nav_payments %}active{% endblock %}

{% block page_title %}Paiement rapide{% endblock %}
{% block page_sub_text %}Facture {{ invoice.invoice_number }}{% endblock %}

{% block extra_css %}
.quick-layout {
    max-width: 580px;
    margin: 0 auto;
}

.quick-card {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.quick-card-head {
    padding: 18px 22px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--bg-raised);
}

.quick-card-title {
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
}

.quick-card-sub { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

.quick-card-body { padding: 22px; }

.invoice-banner {
    background: linear-gradient(135deg, rgba(217,119,6,.10) 0%, rgba(217,119,6,.04) 100%);
    border: 1px solid rgba(217,119,6,.20);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 22px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    text-align: center;
}

.banner-item-label {
    font-size: 10px;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 4px;
    font-weight: 600;
}

.banner-item-value {
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 800;
    color: var(--text-primary);
}

.banner-item-value.accent { color: var(--accent); }
.banner-item-value.green  { color: #16a34a; }

.field-group { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }

.field-label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: .06em;
    text-transform: uppercase;
    color: var(--text-secondary);
}

.field-label span.req { color: var(--accent); }

.field-input,
.field-select {
    background: var(--bg-raised);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 11px 14px;
    width: 100%;
    min-height: 44px;
    transition: border-color .18s, box-shadow .18s;
}

.field-input:focus,
.field-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
}

.field-select option { background: var(--bg-raised); }

.field-error {
    font-size: 11.5px;
    color: #dc2626;
    display: flex;
    align-items: center;
    gap: 4px;
}

.fade-in { animation: fadeIn .35s ease both; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
}
{% endblock %}

{% block content %}

<div style="margin-bottom:20px;">
    <a href="{% url 'payments:outstanding' %}" class="section-link" style="font-size:13px;color:var(--text-secondary);">
        <i class="bi bi-arrow-left me-1"></i> Retour aux factures impay√©es
    </a>
</div>

<div class="quick-layout fade-in">
    <div class="quick-card">
        <div class="quick-card-head">
            <div style="width:40px;height:40px;background:var(--accent-dim);border-radius:var(--radius-sm);display:grid;place-items:center;color:var(--accent);font-size:18px;flex-shrink:0;">
                <i class="bi bi-lightning-charge"></i>
            </div>
            <div>
                <div class="quick-card-title">Paiement rapide</div>
                <div class="quick-card-sub">Facture {{ invoice.invoice_number }} ‚Äî {{ invoice.customer.name|default:"‚Äî" }}</div>
            </div>
        </div>
        <div class="quick-card-body">

            <!-- R√©sum√© de la facture -->
            <div class="invoice-banner">
                <div>
                    <div class="banner-item-label">Total facture</div>
                    <div class="banner-item-value">{{ invoice.total_ttc|floatformat:0 }}</div>
                    <div style="font-size:10px;color:var(--text-muted);">DA</div>
                </div>
                <div>
                    <div class="banner-item-label">D√©j√† pay√©</div>
                    <div class="banner-item-value green">{{ invoice.amount_paid|floatformat:0 }}</div>
                    <div style="font-size:10px;color:var(--text-muted);">DA</div>
                </div>
                <div>
                    <div class="banner-item-label">Solde restant</div>
                    <div class="banner-item-value accent">{{ invoice.balance_due|floatformat:0 }}</div>
                    <div style="font-size:10px;color:var(--text-muted);">DA</div>
                </div>
            </div>

            <!-- Formulaire -->
            <form method="post" id="quickPaymentForm">
                {% csrf_token %}

                <div class="field-group">
                    <label class="field-label">Montant (DA) <span class="req">*</span></label>
                    <input type="number"
                        id="id_amount"
                        name="{{ form.amount.html_name }}"
                        value="{{ form.amount.value|default_if_none:'' }}"
                        step="0.01" min="0.01"
                        max="{{ invoice.balance_due }}"
                        class="field-input {% if form.amount.errors %}is-invalid{% endif %}"
                        placeholder="{{ invoice.balance_due|floatformat:2 }}"
                        autofocus>
                    {% if form.amount.errors %}
                    <div class="field-error"><i class="bi bi-exclamation-circle"></i>{{ form.amount.errors.0 }}</div>
                    {% endif %}
                    <div style="font-size:11.5px;color:var(--text-muted);margin-top:2px;">
                        Maximum&nbsp;: {{ invoice.balance_due|floatformat:2 }} DA
                    </div>
                </div>

                <div class="field-group">
                    <label class="field-label">M√©thode de paiement <span class="req">*</span></label>
                    <select name="{{ form.payment_method.html_name }}"
                        class="field-select {% if form.payment_method.errors %}is-invalid{% endif %}">
                        <option value="">‚Äî S√©lectionner ‚Äî</option>
                        <option value="cash" {% if form.payment_method.value == 'cash' %}selected{% endif %}>üíµ Esp√®ces</option>
                        <option value="bank_transfer" {% if form.payment_method.value == 'bank_transfer' %}selected{% endif %}>üè¶ Virement bancaire</option>
                        <option value="check" {% if form.payment_method.value == 'check' %}selected{% endif %}>üìÑ Ch√®que</option>
                        <option value="card" {% if form.payment_method.value == 'card' %}selected{% endif %}>üí≥ Carte</option>
                        <option value="other" {% if form.payment_method.value == 'other' %}selected{% endif %}>Autre</option>
                    </select>
                    {% if form.payment_method.errors %}
                    <div class="field-error"><i class="bi bi-exclamation-circle"></i>{{ form.payment_method.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="field-group" style="margin-bottom:0;">
                    <label class="field-label">R√©f√©rence bancaire / ch√®que</label>
                    <input type="text"
                        name="{{ form.bank_reference.html_name }}"
                        value="{{ form.bank_reference.value|default_if_none:'' }}"
                        class="field-input {% if form.bank_reference.errors %}is-invalid{% endif %}"
                        placeholder="N¬∞ de r√©f√©rence optionnel‚Ä¶">
                    {% if form.bank_reference.errors %}
                    <div class="field-error"><i class="bi bi-exclamation-circle"></i>{{ form.bank_reference.errors.0 }}</div>
                    {% endif %}
                </div>

                {% if form.non_field_errors %}
                <div style="background:rgba(220,38,38,.08);border:1px solid rgba(220,38,38,.20);border-radius:var(--radius-md);padding:12px 14px;margin-top:14px;">
                    <div style="font-size:13px;color:#dc2626;display:flex;align-items:center;gap:6px;">
                        <i class="bi bi-exclamation-triangle"></i>
                        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                    </div>
                </div>
                {% endif %}

                <div style="display:flex;gap:10px;margin-top:22px;padding-top:18px;border-top:1px solid var(--border);">
                    <button type="submit" class="btn-primary" style="flex:1;padding:12px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;min-height:44px;">
                        <i class="bi bi-check-circle"></i> Confirmer le paiement
                    </button>
                    <a href="{% url 'payments:outstanding' %}" class="btn-ghost" style="padding:12px 18px;font-size:14px;display:inline-flex;align-items:center;gap:6px;min-height:44px;">
                        <i class="bi bi-x-lg"></i> Annuler
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Lien vers le formulaire complet -->
    <div style="text-align:center;margin-top:14px;">
        <a href="{% url 'payments:create' %}?invoice={{ invoice.pk }}" style="font-size:12.5px;color:var(--text-muted);display:inline-flex;align-items:center;gap:4px;">
            <i class="bi bi-arrow-up-right"></i> Utiliser le formulaire complet
        </a>
    </div>
</div>

{% endblock %}